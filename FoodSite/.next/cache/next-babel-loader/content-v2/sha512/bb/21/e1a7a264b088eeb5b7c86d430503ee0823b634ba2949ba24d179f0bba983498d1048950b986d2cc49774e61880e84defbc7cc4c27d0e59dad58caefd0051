{"ast":null,"code":"import { MongoClient } from 'mongodb';\n\nasync function getResListHandler(req, res) {\n  if (req.method === 'GET') {\n    const data = req.body;\n    const name = req.query.name;\n    const page = req.query.pageIndex ? parseInt(req.query.pageIndex) : 1;\n    const limit = req.query.pageSize ? parseInt(req.query.pageSize) : 3;\n    const skip = (page - 1) * limit;\n    const client = await MongoClient.connect('mongodb+srv://dg21:2x9QUtNjUM3tuL6p@cluster0.nxpoghz.mongodb.net/FoodOrderingSite?retryWrites=true&w=majority');\n    const db = client.db();\n    const meetupsCollection = db.collection('ResList');\n    const result = await meetupsCollection.aggregate([{\n      $facet: {\n        totalRecords: [{\n          $match: {\n            name: {\n              $regex: req.query.name\n            }\n          }\n        }, {\n          $count: 'description'\n        }],\n        data: [{\n          $match: {\n            name: {\n              $regex: req.query.name\n            }\n          }\n        }, {\n          $skip: skip\n        }, {\n          $limit: limit\n        }]\n      }\n    }]).toArray();\n    console.log(result);\n    const ressy = [{\n      totalRecords: result[0].totalRecords,\n      data: result[0].data.map(meetup => ({\n        address: meetup.address,\n        description: meetup.description,\n        image: meetup.image,\n        id: meetup._id.toString(),\n        menu: meetup.menu,\n        name: meetup.name\n      }))\n    }];\n    client.close();\n    res.send(ressy);\n  }\n}\n\n;\nexport default getResListHandler;","map":null,"metadata":{},"sourceType":"module"}