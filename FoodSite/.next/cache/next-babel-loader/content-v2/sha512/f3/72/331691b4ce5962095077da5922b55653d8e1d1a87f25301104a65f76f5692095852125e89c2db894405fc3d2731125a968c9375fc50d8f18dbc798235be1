{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nimport styles from \"./Loginsignup.module.css\";\nimport { Fragment, useContext, useState } from \"react\";\nimport Link from 'next/link';\nimport { useRef } from \"react\";\nimport AuthContext from \"../store/use-context\";\nimport { useRouter } from \"next/router\";\n\nvar LoginSignup = function LoginSignup() {\n  var emailRef = useRef();\n  var passRef = useRef();\n  var router = useRouter();\n  var authCtx = useContext(AuthContext);\n\n  var _useState = useState(false),\n      isLoading = _useState[0],\n      setIsLoading = _useState[1];\n\n  var _useState2 = useState(true),\n      properEmail = _useState2[0],\n      setProperEmail = _useState2[1];\n\n  var _useState3 = useState(true),\n      properPass = _useState3[0],\n      setProperPassword = _useState3[1];\n\n  if (authCtx.isLoggedIn) {\n    return /*#__PURE__*/_jsx(Link, {\n      href: \"/AllRestaurants\",\n      children: /*#__PURE__*/_jsx(\"div\", {\n        className: styles.signup,\n        children: /*#__PURE__*/_jsx(\"b\", {\n          children: \"Already Logged in! Start Browsing Here. \"\n        })\n      })\n    });\n  }\n\n  var loginHandler = function loginHandler(event) {\n    var _emailRef$current, _passRef$current;\n\n    setIsLoading(true);\n    var currEmail = (_emailRef$current = emailRef.current) === null || _emailRef$current === void 0 ? void 0 : _emailRef$current.value;\n    var currPass = (_passRef$current = passRef.current) === null || _passRef$current === void 0 ? void 0 : _passRef$current.value;\n    event.preventDefault();\n    fetch('https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=AIzaSyDRIvxAwx8KqrhXOQpIzkSave61memF2Uw', {\n      method: 'POST',\n      body: JSON.stringify({\n        email: currEmail,\n        password: currPass,\n        returnSecureToken: true\n      }),\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    }).then().then(function (res) {\n      setIsLoading(false);\n\n      if (res.ok) {\n        return res.json();\n      } else {\n        return res.json().then(function (data) {\n          var errorMessage = 'Auth failed';\n\n          if (data && data.error && data.error.message) {\n            errorMessage = data.error.message;\n\n            if (data.error.message === 'INVALID_EMAIL') {\n              setProperEmail(false);\n            } else {\n              setProperPassword(false);\n            }\n          }\n\n          throw new Error(errorMessage);\n        });\n      }\n    }).then(function (data) {\n      fetch('https://reactfirst-48147-default-rtdb.firebaseio.com/user.json').then().then(function (r) {\n        if (r.ok) {\n          return r.json();\n        } else {\n          return r.json().then(function (d) {\n            var errorMessage = 'Auth failed';\n\n            if (d && d.error && d.error.message) {\n              errorMessage = data.error.message;\n            }\n\n            throw new Error(errorMessage);\n          });\n        }\n      }).then(function (da) {\n        var currfirstName = '';\n        var isBusiness = false;\n        var number = 0;\n        console.log(JSON.stringify(da));\n\n        var _iterator = _createForOfIteratorHelper(da),\n            _step;\n\n        try {\n          for (_iterator.s(); !(_step = _iterator.n()).done;) {\n            var value = _step.value;\n            console.log(value);\n\n            for (var values in value) {\n              var _value$values;\n\n              console.log(value[values]);\n\n              if (((_value$values = value[values]) === null || _value$values === void 0 ? void 0 : _value$values['email'].toLowerCase()) === currEmail.toLowerCase()) {\n                if (number == 1) {\n                  isBusiness = true;\n                  authCtx.login(currEmail, value[values]['businessName'], value[values]['address'], true);\n                  break;\n                } else {\n                  authCtx.login(currEmail, value[values]['firstName'], value[values]['lastName'], false);\n                  break;\n                }\n              }\n            }\n\n            number += 1;\n          }\n        } catch (err) {\n          _iterator.e(err);\n        } finally {\n          _iterator.f();\n        }\n\n        if (isBusiness) {\n          router.push('/business');\n        } else {\n          router.push('/AllRestaurants');\n        }\n      });\n    })[\"catch\"](function (err) {\n      alert(err.message);\n    });\n  };\n\n  return /*#__PURE__*/_jsxs(Fragment, {\n    children: [/*#__PURE__*/_jsxs(\"div\", {\n      className: styles.loginContainer,\n      children: [/*#__PURE__*/_jsx(\"label\", {\n        htmlFor: \"Email\",\n        children: \" Email\"\n      }), /*#__PURE__*/_jsx(\"input\", {\n        placeholder: \"email@email.com\",\n        onInput: function onInput() {\n          if (!properEmail) {\n            setProperEmail(true);\n          }\n        },\n        ref: emailRef,\n        type: \"email\",\n        name: \"Email\",\n        className: \"\".concat(styles.login, \" \").concat(properEmail ? '' : styles.flagged)\n      }), /*#__PURE__*/_jsx(\"label\", {\n        htmlFor: \"Password\",\n        children: \"Password\"\n      }), /*#__PURE__*/_jsx(\"input\", {\n        placeholder: \"xxxxxx\",\n        onInput: function onInput() {\n          if (!properPass) {\n            setProperPassword(true);\n          }\n        },\n        ref: passRef,\n        name: \"Password\",\n        type: \"password\",\n        className: \"\".concat(styles.login, \" \").concat(properPass && properEmail ? '' : styles.flagged)\n      })]\n    }), /*#__PURE__*/_jsx(\"div\", {\n      className: styles.buttonContainer,\n      children: /*#__PURE__*/_jsx(\"button\", {\n        onClick: loginHandler,\n        className: \" \".concat(properEmail && properPass ? styles.btnClass : styles.errBtn),\n        children: \" Login\"\n      })\n    }), /*#__PURE__*/_jsx(Link, {\n      href: \"/signup\",\n      children: /*#__PURE__*/_jsx(\"div\", {\n        className: styles.signup,\n        children: \"Don't Have an Account? Sign Up Here!\"\n      })\n    })]\n  });\n};\n\nexport default LoginSignup;","map":null,"metadata":{},"sourceType":"module"}