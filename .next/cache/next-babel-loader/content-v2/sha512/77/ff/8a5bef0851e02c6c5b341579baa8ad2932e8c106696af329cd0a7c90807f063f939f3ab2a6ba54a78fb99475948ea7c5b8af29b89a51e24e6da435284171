{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/dgaidar/Documents/VScode/React/FoodOrderingSite/node_modules/@babel/runtime/regenerator\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _asyncToGenerator from \"C:/Users/dgaidar/Documents/VScode/React/FoodOrderingSite/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\dgaidar\\\\Documents\\\\VScode\\\\React\\\\FoodOrderingSite\\\\pages\\\\AllRestaurants\\\\[businessId]\\\\index.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport DetailCard from \"../../../components/Card/DetailCard\";\nimport { useContext, useSearchParams, useState, useEffect } from \"react\";\nimport AuthContext from \"../../../components/store/use-context\";\nimport Image from \"../../../components/Details/image\";\nimport Details from '../../../components/Details/Details';\nimport Menu from \"../../../components/Details/Menu\";\nimport ItemCard from \"../../../components/Card/ItemCard\";\nimport ModalCart from \"../../../components/Cart/ModalCart\";\nimport ReviewPage from \"../../../components/Details/ReviewPage\";\n\nvar businessDetails = function businessDetails(props) {\n  _s();\n\n  var _props$restaurant, _props$restaurant2, _props$restaurant3, _props$restaurant4, _props$restaurant5;\n\n  var _useState = useState(1),\n      pageNum = _useState[0],\n      setPageNum = _useState[1];\n\n  var _useState2 = useState(null),\n      totalNum = _useState2[0],\n      setTotalNum = _useState2[1];\n\n  var _useState3 = useState([]),\n      reviewList = _useState3[0],\n      setReviewList = _useState3[1];\n\n  var _useState4 = useState(false),\n      isLoading = _useState4[0],\n      setIsLoading = _useState4[1];\n\n  function getter() {\n    return _getter.apply(this, arguments);\n  }\n\n  function _getter() {\n    _getter = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var enteredItemData,\n          response,\n          data,\n          _data$0$totalRecords$,\n          _args = arguments;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              enteredItemData = _args.length > 0 && _args[0] !== undefined ? _args[0] : 1;\n              setIsLoading(true);\n              _context.next = 4;\n              return fetch(\"../api/getHandler?pageIndex=\".concat(enteredItemData, \"&pageSize=2&restaurantURL=\").concat(window.location.pathname), {\n                method: 'GET'\n              });\n\n            case 4:\n              response = _context.sent;\n              _context.next = 7;\n              return response.json();\n\n            case 7:\n              data = _context.sent;\n              console.log(data);\n              setIsLoading(false);\n\n              if (!totalNum) {\n                setTotalNum(data[0].totalRecords[0] ? parseInt((_data$0$totalRecords$ = data[0].totalRecords[0]) === null || _data$0$totalRecords$ === void 0 ? void 0 : _data$0$totalRecords$.body) : 1);\n              }\n\n              setReviewList(data[0].data);\n\n            case 12:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n    return _getter.apply(this, arguments);\n  }\n\n  useEffect(function () {\n    getter();\n  }, []);\n\n  var plus = function plus() {\n    setPageNum(function (prevVal) {\n      if (totalNum / 2 > prevVal) {\n        prevVal++;\n        getter(prevVal);\n      }\n\n      return prevVal;\n    });\n  };\n\n  var minus = function minus() {\n    setPageNum(function (prevVal) {\n      if (prevVal > 1) {\n        prevVal--;\n        getter(prevVal);\n      }\n\n      return prevVal;\n    });\n  };\n\n  function addReviewHandler(_x) {\n    return _addReviewHandler.apply(this, arguments);\n  }\n\n  function _addReviewHandler() {\n    _addReviewHandler = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(enteredItemData) {\n      var response, data;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return fetch('../api/ReviewHandler', {\n                method: 'POST',\n                body: JSON.stringify({\n                  subject: enteredItemData.subject,\n                  body: enteredItemData.body,\n                  date: enteredItemData.date,\n                  stars: enteredItemData.stars,\n                  restaurant: props.restaurant.id,\n                  user: authCtx.user\n                }),\n                headers: {\n                  'Content-Type': 'application/json'\n                }\n              });\n\n            case 2:\n              response = _context2.sent;\n              _context2.next = 5;\n              return response.json();\n\n            case 5:\n              data = _context2.sent;\n\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n    return _addReviewHandler.apply(this, arguments);\n  }\n\n  var authCtx = useContext(AuthContext);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      marginLeft: '8vw',\n      marginRight: '8vw',\n      marginBottom: '10vw'\n    },\n    children: [/*#__PURE__*/_jsxDEV(DetailCard, {\n      children: /*#__PURE__*/_jsxDEV(Image, {\n        image: (_props$restaurant = props.restaurant) === null || _props$restaurant === void 0 ? void 0 : _props$restaurant.image,\n        details: (_props$restaurant2 = props.restaurant) === null || _props$restaurant2 === void 0 ? void 0 : _props$restaurant2.name,\n        subtitle: (_props$restaurant3 = props.restaurant) === null || _props$restaurant3 === void 0 ? void 0 : _props$restaurant3.description\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 21\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 9\n    }, _this), /*#__PURE__*/_jsxDEV(DetailCard, {\n      children: /*#__PURE__*/_jsxDEV(Details, {\n        description: (_props$restaurant4 = props.restaurant) === null || _props$restaurant4 === void 0 ? void 0 : _props$restaurant4.paragraph\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 21\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 9\n    }, _this), /*#__PURE__*/_jsxDEV(ItemCard, {\n      children: /*#__PURE__*/_jsxDEV(Menu, {\n        menu: (_props$restaurant5 = props.restaurant) === null || _props$restaurant5 === void 0 ? void 0 : _props$restaurant5.menu\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 19\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 9\n    }, _this), /*#__PURE__*/_jsxDEV(ItemCard, {\n      children: /*#__PURE__*/_jsxDEV(ReviewPage, {\n        addReviewHandler: addReviewHandler,\n        total: totalNum,\n        isLoading: isLoading,\n        getter: getter,\n        pageNum: pageNum,\n        reviewList: reviewList,\n        plus: plus,\n        minus: minus\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 19\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 9\n    }, _this), authCtx.isOpen && /*#__PURE__*/_jsxDEV(ModalCart, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 28\n    }, _this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 77,\n    columnNumber: 12\n  }, _this);\n};\n\n_s(businessDetails, \"vXbZxpfa+jY0vJ+weBHiuTkEezk=\");\n\nexport var __N_SSG = true;\nexport default businessDetails;","map":{"version":3,"sources":["C:/Users/dgaidar/Documents/VScode/React/FoodOrderingSite/pages/AllRestaurants/[businessId]/index.js"],"names":["DetailCard","useContext","useSearchParams","useState","useEffect","AuthContext","Image","Details","Menu","ItemCard","ModalCart","ReviewPage","businessDetails","props","pageNum","setPageNum","totalNum","setTotalNum","reviewList","setReviewList","isLoading","setIsLoading","getter","enteredItemData","fetch","window","location","pathname","method","response","json","data","console","log","totalRecords","parseInt","body","plus","prevVal","minus","addReviewHandler","JSON","stringify","subject","date","stars","restaurant","id","user","authCtx","headers","marginLeft","marginRight","marginBottom","image","name","description","paragraph","menu","isOpen"],"mappings":"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","sourcesContent":["\r\nimport DetailCard from \"../../../components/Card/DetailCard\";\r\nimport { useContext, useSearchParams, useState, useEffect } from \"react\";\r\nimport AuthContext from \"../../../components/store/use-context\";\r\nimport Image from \"../../../components/Details/image\";\r\nimport Details from '../../../components/Details/Details';\r\nimport Menu from \"../../../components/Details/Menu\";\r\nimport ItemCard from \"../../../components/Card/ItemCard\";\r\nimport ModalCart from \"../../../components/Cart/ModalCart\";\r\nimport ReviewPage from \"../../../components/Details/ReviewPage\";\r\nimport { MongoClient, ObjectId, } from \"mongodb\";\r\n\r\nconst businessDetails = (props) => {\r\n    const [pageNum, setPageNum] = useState(1);\r\n    const [totalNum, setTotalNum] = useState(null);\r\n    const [reviewList, setReviewList] = useState([]);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    async function getter(enteredItemData = 1) {\r\n        setIsLoading(true);\r\n        const response = await fetch(`../api/getHandler?pageIndex=${enteredItemData}&pageSize=2&restaurantURL=${window.location.pathname}`,\r\n        {\r\n            method: 'GET',\r\n        } );\r\n        const data = await response.json();\r\n        console.log(data);\r\n        setIsLoading(false);\r\n        if (!totalNum){\r\n            setTotalNum(data[0].totalRecords[0] ? parseInt(data[0].totalRecords[0]?.body) : 1);\r\n        }\r\n        setReviewList(data[0].data);\r\n    }\r\n    useEffect(() => {\r\n        getter()\r\n    },[])\r\n    const plus = () => {\r\n        setPageNum(prevVal => {\r\n           \r\n            if (totalNum/2 > prevVal){\r\n            prevVal++;\r\n            getter(prevVal);\r\n            }\r\n            \r\n            return prevVal;\r\n        })\r\n    }\r\n    const minus = () => {\r\n        setPageNum(prevVal => {\r\n            if (prevVal > 1){\r\n            prevVal--;\r\n            getter(prevVal);\r\n            }\r\n            return prevVal;\r\n        })\r\n    }\r\n    async function addReviewHandler(enteredItemData) {\r\n        const response = await fetch('../api/ReviewHandler', {\r\n          method: 'POST',\r\n          body: JSON.stringify({\r\n            subject: enteredItemData.subject,\r\n            body: enteredItemData.body,\r\n            date: enteredItemData.date,\r\n            stars: enteredItemData.stars,\r\n            restaurant: props.restaurant.id,\r\n            user: authCtx.user\r\n          }),\r\n          headers: {\r\n            'Content-Type': 'application/json'\r\n          }\r\n        });\r\n    \r\n        const data = await response.json();\r\n        \r\n    }\r\n    const authCtx = useContext(AuthContext);\r\n   \r\n    \r\n    return <div style = {{marginLeft: '8vw', marginRight: '8vw', marginBottom: '10vw'}}>\r\n\r\n        <DetailCard><Image image = {props.restaurant?.image} details = {props.restaurant?.name} subtitle = {props.restaurant?.description}/></DetailCard>\r\n        <DetailCard><Details description = {props.restaurant?.paragraph}/></DetailCard>\r\n        <ItemCard><Menu menu = {props.restaurant?.menu}/></ItemCard>\r\n        <ItemCard><ReviewPage addReviewHandler = {addReviewHandler} total = {totalNum} isLoading = {isLoading} getter = {getter} pageNum = {pageNum} reviewList = {reviewList} plus = {plus} minus = {minus}/></ItemCard>\r\n        {authCtx.isOpen && <ModalCart/>}\r\n    </div>\r\n    \r\n}\r\nexport async function getStaticPaths() {\r\n    const client = await MongoClient.connect(\r\n      'mongodb+srv://dg21:2x9QUtNjUM3tuL6p@cluster0.nxpoghz.mongodb.net/FoodOrderingSite?retryWrites=true&w=majority'  );\r\n      const db = client.db();\r\n\r\n      const meetupsCollection = db.collection('reviewList');\r\n      const meetups = await meetupsCollection.find({}, { restaurant: 1 }).toArray();\r\n   \r\n      client.close();\r\n    \r\n      return {\r\n        fallback: \"blocking\",\r\n        paths: meetups.map((meetup) => ({\r\n          params: { businessId: meetup._id.toString() },\r\n        })),\r\n      };\r\n  }\r\n  \r\n  export async function getStaticProps(context) {\r\n    // fetch data for a single meetup\r\n  \r\n    const meetupId = context.params.businessId;\r\n    const client = await MongoClient.connect(\r\n      'mongodb+srv://dg21:2x9QUtNjUM3tuL6p@cluster0.nxpoghz.mongodb.net/FoodOrderingSite?retryWrites=true&w=majority'  );\r\n    const db = client.db();\r\n  \r\n    const resCollection = db.collection('ResList');\r\n    const res = await resCollection.findOne({\r\n        _id: ObjectId(meetupId)\r\n    })\r\n\r\n    client.close();\r\n  \r\n    return {\r\n      props: {\r\n        restaurant: {\r\n            name: res.name,\r\n            address: res.address,\r\n            image: res.image,\r\n            id: res._id.toString(),\r\n            description: res.description,\r\n            menu: res.menu,\r\n            paragraph: res.paragraph\r\n        }\r\n      },\r\n      revalidate: 10\r\n    };\r\n  }\r\n\r\n\r\nexport default businessDetails;"]},"metadata":{},"sourceType":"module"}