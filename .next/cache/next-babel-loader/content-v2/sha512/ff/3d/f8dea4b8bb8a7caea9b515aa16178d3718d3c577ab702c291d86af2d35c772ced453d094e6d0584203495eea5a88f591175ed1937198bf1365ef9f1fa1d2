{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { useContext, useEffect, useState } from \"react\";\nimport Card from \"../../../components/Card/Card\";\nimport SearchInfo from \"../../../components/Details/SearchInfo\";\nimport AuthContext from \"../../../components/store/use-context\";\nimport styles from '../../../components/Details/SearchInfo.module.css';\nimport Head from 'next/Head';\n\nconst search = () => {\n  const authCtx = useContext(AuthContext);\n  const {\n    0: currSearch,\n    1: setCurrSearch\n  } = useState(null);\n  const {\n    0: pageNum,\n    1: setPageNum\n  } = useState(1);\n  const {\n    0: totalNum,\n    1: setTotalNum\n  } = useState(false);\n  const {\n    0: isLoading,\n    1: setIsLoading\n  } = useState(false);\n  const {\n    0: currData,\n    1: setCurrData\n  } = useState([]);\n  const {\n    0: circArr,\n    1: setCircArr\n  } = useState(null);\n  useEffect(() => {\n    const ressy = setTimeout(() => {\n      if (currSearch == null) {\n        setCurrSearch(authCtx.searchStr);\n        getter(authCtx.searchStr);\n      } else if (currSearch != '') {\n        getter(currSearch);\n        console.log('hello!', currSearch);\n        console.log(currData);\n      } else {\n        setCurrData([]);\n      }\n    }, 500);\n    return () => {\n      clearTimeout(ressy);\n    };\n  }, [currSearch]);\n\n  async function getter(value, enteredIndex = 1) {\n    var _data$0$totalRecords$;\n\n    setIsLoading(true);\n    const response = await fetch(`../api/getResListHandler?name=${value}&pageIndex=${enteredIndex}&pageSize=3`, {\n      method: 'GET'\n    });\n    const data = await response.json();\n    setIsLoading(false);\n    setCurrData(data[0].data);\n    console.log(data);\n    setTotalNum(data[0].totalRecords[0] ? parseInt((_data$0$totalRecords$ = data[0].totalRecords[0]) === null || _data$0$totalRecords$ === void 0 ? void 0 : _data$0$totalRecords$.description) : 1);\n  }\n\n  const plus = () => {\n    setPageNum(prevVal => {\n      if (totalNum / 2 > prevVal) {\n        console.log(totalNum);\n        prevVal++;\n        getter(currSearch, prevVal);\n      }\n\n      console.log(prevVal);\n      return prevVal;\n    });\n  };\n\n  const minus = () => {\n    setPageNum(prevVal => {\n      if (prevVal > 1) {\n        prevVal--;\n        getter(currSearch, prevVal);\n      }\n\n      return prevVal;\n    });\n  };\n\n  useEffect(() => {\n    if (totalNum) {\n      setCircArr(prevVal => {\n        prevVal = [];\n        console.log(totalNum / 2);\n\n        while (prevVal.length < parseInt(totalNum / 2)) {\n          if (prevVal.length == pageNum - 1) {\n            prevVal.push( /*#__PURE__*/_jsx(\"span\", {\n              className: styles.selectedBtn,\n              children: \"  \\u25CF\"\n            }));\n          } else {\n            prevVal.push( /*#__PURE__*/_jsx(\"span\", {\n              style: {\n                color: '#797979'\n              },\n              children: \" \\u25CF\"\n            }));\n          }\n        }\n\n        return prevVal;\n      });\n    }\n  }, [totalNum, pageNum]);\n\n  const changeHandler = e => {\n    setPageNum(1);\n    setCurrSearch(e.target.value);\n  };\n\n  return /*#__PURE__*/_jsxs(Card, {\n    children: [/*#__PURE__*/_jsx(Head, {\n      children: /*#__PURE__*/_jsx(\"title\", {\n        children: \"Search\"\n      })\n    }), /*#__PURE__*/_jsx(\"h2\", {\n      className: styles.name,\n      children: \"Search\"\n    }), /*#__PURE__*/_jsx(\"input\", {\n      placeHolder: \"search for business!\",\n      onInput: changeHandler,\n      className: styles.input,\n      value: currSearch\n    }), !isLoading && currData != '' && /*#__PURE__*/_jsx(\"div\", {\n      className: styles.name,\n      style: {\n        color: 'rgba(0,0,0,0.8)'\n      },\n      children: \" Search Results: \"\n    }), /*#__PURE__*/_jsx(\"hr\", {}), isLoading && /*#__PURE__*/_jsx(\"h2\", {\n      className: styles.name,\n      children: \"Searching for Restaurants...\"\n    }), !isLoading && /*#__PURE__*/_jsxs(\"div\", {\n      children: [/*#__PURE__*/_jsx(\"div\", {\n        children: currData.map(key => /*#__PURE__*/_jsx(SearchInfo, {\n          name: key.name,\n          id: key.id,\n          image: key.image,\n          address: key.address,\n          description: key.description,\n          isLoading: isLoading\n        }, key.id))\n      }), /*#__PURE__*/_jsx(\"div\", {\n        children: circArr\n      }), pageNum != 1 && /*#__PURE__*/_jsx(\"button\", {\n        className: styles.nextBtn,\n        onClick: minus,\n        children: \"previous\"\n      }), pageNum < totalNum / 2 && /*#__PURE__*/_jsx(\"button\", {\n        className: styles.nextBtn,\n        onClick: plus,\n        children: \"next\"\n      })]\n    })]\n  });\n};\n\nexport default search;","map":null,"metadata":{},"sourceType":"module"}